<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Distance RTIRL</title>
    <style>
      body {
        margin: 0;
        background: transparent;
        font-family: sans-serif;
        font-size: 40px;
        color: white;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="distance">Waiting…</div>

    <!-- Script chargé en bas pour garantir son exécution après le chargement -->
    <script src="https://cdn.jsdelivr.net/npm/@rtirl/api@latest/lib/index.min.js"></script>
    <script>
      // Attendre que le SDK soit bien chargé
      const waitForRtirl = () => {
        if (typeof rtirl === "undefined") {
          setTimeout(waitForRtirl, 200);
        } else {
          initRtirl();
        }
      };

      function initRtirl() {
        const client = new rtirl.Client("rwnzr4rrfrltggq9");

        client.on("distance", (data) => {
          if (data && data.value) {
            const distanceKm = (data.value / 1000).toFixed(1);
            document.getElementById("distance").innerText = `${distanceKm}`;
          }
        });

        setTimeout(() => {
          const txt = document.getElementById("distance").innerText;
          if (txt === "Waiting…") {
            document.getElementById("distance").innerText = "Pas de données";
          }
        }, 7000);
      }

      // Lancer l’attente au chargement de la page
      window.addEventListener("load", waitForRtirl);
    </script>
  </body>
</html>
